namespace cdm.product.common.settlement
version "${project.version}"

import cdm.base.datetime.*
import cdm.base.staticdata.party.*

func CashflowSettlementTerms: <"The Payout type contains a cashflow to replicate the FpML structure. This function creates SettlementTerms from the Cashflow that can be used in the Execution -> settlementTerm.">
	inputs:
		cashflow Cashflow (0..1)
		counterparties Counterparty (2..2)
		relatedParties RelatedPartyReference (0..*)

	output:
		settlementTerms SettlementTerms (0..1)

	alias settlementDate:
		ConvertToAdjustableOrRelativeDate(cashflow -> cashflowDate)
	
	assign-output settlementTerms -> payerReceiver -> payerPartyReference:
		if cashflow -> payerReceiver -> payer exists
		then ExtractCounterpartyBySide( counterparties, cashflow -> payerReceiver -> payer ) -> partyReference
		else ExtractRelatedParty( relatedParties, cashflow -> payerReceiver -> payerRelatedParty ) -> partyReference only-element
		
	assign-output settlementTerms -> payerReceiver -> receiverPartyReference:
		if cashflow -> payerReceiver -> receiver exists
		then ExtractCounterpartyBySide( counterparties, cashflow -> payerReceiver -> receiver ) -> partyReference
		else ExtractRelatedParty( relatedParties, cashflow -> payerReceiver -> receiverRelatedParty ) -> partyReference only-element
	
	assign-output settlementTerms -> assetIdentifier:
		cashflow -> payoutQuantity -> assetIdentifier

	assign-output settlementTerms -> settlementType:
		SettlementTypeEnum -> Cash

	assign-output settlementTerms -> settlementDate:
		settlementDate




